<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="gwopa">

<body>
  <metal:block fill-slot="top_slot"
        tal:define="dummy python:request.set('disable_border',1)" />

  <div metal:fill-slot="main" tal:define="portal_state context/@@plone_portal_state;
                                          portal_url portal_state/portal_url;">
    <metal:main-macro define-macro="main">
      <!-- <script src="https://kryogenix.org/code/browser/sorttable/sorttable.js"></script> -->
      <div>
        <h1 class="documentFirstHeading" i18n:translate="">GWOPA administration page</h1>
        <p class="documentDescription" i18n:translate="">Control panel to configure and view all the important system parameters</p>
        <div class="visualClear"></div>
      </div>

      <h2><tal:omit-tag i18n:translate=""> Projects </tal:omit-tag>
        <a class="pat-plone-modal" id="add-user" data-pat-plone-modal="{&quot;actionOptions&quot;: {&quot;displayInModal&quot;: false}}" tal:attributes="href string:${portal_url}/projects/++add++Project" href="#">
          <button id="add-new-user" class="context focus" i18n:translate=""> + New Project</button>
        </a>
      </h2>
      <tal:block tal:define="elements view/getProjects">
        <table class="sortable" tal:condition="not:elements">
          No Projects found in the Platform.
        </table>
        <table class="sortable" tal:condition="elements">
          <thead>
            <tr>
              <th scope="col" i18n:translate=""> Project </th>
              <th scope="col" i18n:translate=""> Start Date </th>
              <th scope="col" i18n:translate=""> End Date </th>
              <th scope="col" i18n:translate=""> Admin role </th>
              <th scope="col" i18n:translate=""> Country </th>
              <th scope="col" i18n:translate=""> Actions </th>
            </tr>
          </thead>
          <tbody>
            <tr tal:repeat="project elements">
              <td class="paddingleft20">
                <i class="fa fa-caret-right"></i>
                <a href="" tal:attributes="href string:${project/url}/" target="_blank" tal:content="project/title">Title</a>
              </td>
              <td tal:content="project/start"> Start </td>
              <td tal:content="project/end"> End </td>
              <td tal:content="project/manager"> Admin </td>
              <td tal:content="project/country"> Country </td>
              <td style="text-align: center;">
                <a href="" tal:attributes="href string:${project/url}/edit"><i class="fa fa-pencil-square-o" aria-hidden="true" style="color:green"></i></a>
                <button type="button" class="remove label label-important"
                      data-container="body"
                      data-toggle="popover"
                      data-placement="left"
                      data-html="true"
                      data-trigger="focus"
                      data-original-title="Esborra"
                      tal:attributes="data-item project/url;">
                  <i class="fa fa-trash-o" aria-hidden="true" style="color:red"></i></button>
              </td>
            </tr>
          </tbody>
        </table>
      </tal:block>

      <h2> Areas </h2>
      <tal:block tal:define="elements view/getAreas">
        <table class="sortable" tal:condition="not:elements">
          No Areas found in the Platform. A Project must be created to create an Area inside it.
        </table>
        <table class="sortable" tal:condition="elements">
          <thead>
            <tr>
              <th i18n:translate="" scope="col"> Area </th>
              <th i18n:translate="" scope="col"> Container </th>
              <th scope="col" i18n:translate="" style="text-align: center;"> Actions </th>
            </tr>
          </thead>
          <tbody>
            <tr tal:repeat="area elements">
              <td class="paddingleft20">
                <i class="fa fa-caret-right"></i>
                <a href="" tal:attributes="href string:${area/url}/" target="_blank" tal:content="area/title">Title</a>
              </td>
              <td tal:content="area/parent"> Parent </td>
              <td style="text-align: center;">
                <a href="" tal:attributes="href string:${area/url}/edit"><i class="fa fa-pencil-square-o" aria-hidden="true" style="color:green"></i></a>
                <a href="" tal:attributes="href string:${area/url}/edit"><i class="fa fa-trash-o" aria-hidden="true" style="color:red"></i></a>
              </td>
            </tr>
          </tbody>
        </table>
      </tal:block>

      <h2> Users
        <a class="pat-plone-modal" id="add-user" data-pat-plone-modal="{&quot;actionOptions&quot;: {&quot;displayInModal&quot;: false}}" tal:attributes="href string:${portal_url}/@@new-user" href="#">
          <button id="add-new-user" class="context focus"> + New User</button>
        </a>
      </h2>
      <tal:block tal:define="users view/getUsers" >
        <table class="sortable" tal:condition="not:users">
          No users found in the Platform
        </table>
        <table class="sortable" tal:condition="users">
          <thead>
            <tr>
              <th i18n:translate="" scope="col" class="paddingleft20"> UserID </th>
              <th i18n:translate="" scope="col" style="width: 80px; text-align: center;"> Actions </th>
            </tr>
          </thead>
          <tbody>
            <tr tal:repeat="user users">
              <td class="paddingleft20">
                <i class="fa fa-user"></i>
                <a href="" tal:attributes="href string:${portal_url}/profile/${user/id}" tal:content="user/id"> User ID </a>
              </td>
              <td style="text-align: center;">
                <a href="" tal:attributes="href string:${portal_url}/@@user-information?userid=${user/id}"><i class="fa fa-pencil-square-o" aria-hidden="true" style="color:green"></i></a>
                <a href="" tal:attributes="href string:${portal_url}/@@user-information?userid=${user/id}"><i class="fa fa-trash-o" aria-hidden="true" style="color:red"></i></a>
              </td>
            </tr>
          </tbody>
        </table>
      </tal:block>

      <h2> WOP Platforms
        <a class="pat-plone-modal" id="add-platform" data-pat-plone-modal="{&quot;actionOptions&quot;: {&quot;displayInModal&quot;: false}}" tal:attributes="href string:${portal_url}/config/platforms/++add++Platform" href="#">
          <button id="add-new-platform" class="context focus"> + New WOP Platform </button>
        </a>
      </h2>
      <tal:block tal:define="elements view/getPlatforms">
        <table class="sortable" tal:condition="not:elements">
          No Platforms found in the Platform.
        </table>
        <table class="sortable" tal:condition="elements">
          <thead>
            <tr>
              <th i18n:translate="" scope="col"> Project </th>
              <th i18n:translate="" scope="col"> Country/Countries </th>
            </tr>
          </thead>
          <tbody>
            <tr tal:repeat="project elements">
              <td class="paddingleft20">
                <i class="fa fa-caret-right"></i>
                <a href="" tal:attributes="href string:${project/url}" tal:content="project/title"> Project Title </a>
              </td>
              <td tal:content="project/country"> Country </td>
            </tr>
          </tbody>
        </table>
      </tal:block>

      <h2> WOP Programs
        <a class="pat-plone-modal" id="add-program" data-pat-plone-modal="{&quot;actionOptions&quot;: {&quot;displayInModal&quot;: false}}" tal:attributes="href string:${portal_url}/config/programs/++add++Program" href="#">
          <button id="add-new-program" class="context focus"> + New WOP Program </button>
        </a>
      </h2>
      <tal:block tal:define="elements view/getPrograms">
        <table class="sortable" tal:condition="not:elements">
          No Programs found in the Platform.
        </table>
        <table class="sortable" tal:condition="elements">
          <thead>
            <tr>
              <th i18n:translate="" scope="col"> Program </th>
              <th i18n:translate="" scope="col"> Country/Countries </th>
              <th i18n:translate="" scope="col"> Contact </th>
            </tr>
          </thead>
          <tbody>
            <tr tal:repeat="project elements">
              <td class="paddingleft20">
                <i class="fa fa-caret-right"></i>
                <a href="" tal:attributes="href string:${project/url}" tal:content="project/title"> Program Title </a>
              </td>
              <td tal:content="project/country"> Country </td>
              <td tal:content="project/email"> Contact </td>
            </tr>
          </tbody>
        </table>
      </tal:block>

      <h2> WOP Partners
        <a class="pat-plone-modal" id="add-partner" data-pat-plone-modal="{&quot;actionOptions&quot;: {&quot;displayInModal&quot;: false}}" tal:attributes="href string:${portal_url}/config/programs/++add++Partner" href="#">
          <button id="add-new-partner" class="context focus"> + New WOP Partner </button>
        </a>
      </h2>
      <tal:block tal:define="elements view/getPartners">
        <table class="sortable" tal:condition="not:elements">
          No Partners found in the Platform.
        </table>
        <table class="sortable" tal:condition="elements">
          <thead>
            <tr>
              <th i18n:translate="" scope="col"> Partner </th>
              <th i18n:translate="" scope="col"> Country/Countries </th>
            </tr>
          </thead>
          <tbody>
            <tr tal:repeat="project elements">
              <td class="paddingleft20">
                <i class="fa fa-caret-right"></i>
                <a href="" tal:attributes="href string:${project/url}" tal:content="project/title"> Partner </a>
              </td>
              <td tal:content="project/country"> Country </td>
            </tr>
          </tbody>
        </table>
      </tal:block>

      <h2> Currency/Measuring/Capacity Settings
        <a class="pat-plone-modal" data-pat-plone-modal="{&quot;actionOptions&quot;: {&quot;displayInModal&quot;: false}}; title: PMP Settings" tal:attributes="href string:${portal_url}/config/settings/edit" href="#">
          <button class="context focus"> View or edit values </button>
        </a>
      </h2>
      <p> Shows the current values for: Exchange Currency / Measuring Unit / Measuring Frequency / Capacity Changes</p>

    <script  type="text/javascript">
      $(function() {
          $('button.remove').on('click', function (e) {
            debugger;
            $('[data-toggle="popover"]').each(function () {
                if (!$(this).is(e.target) && $(this).has(e.target).length === 0 && $('.popover').has(e.target).length === 0) {
                    $(this).popover('hide');
                } else {
                  var name=$(this).data()['item'];
                  var portal_type=$(this).data()['type'];
                  var message="hola";
                  $(this).attr('data-content',message);
                  $(this).popover('show');
                }
            });
        });
    </script>

    </metal:main-macro>
  </div>

</body>
</html>
