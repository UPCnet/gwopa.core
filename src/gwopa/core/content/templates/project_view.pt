<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
    xmlns:tal="http://xml.zope.org/namespaces/tal"
    xmlns:metal="http://xml.zope.org/namespaces/metal"
    xmlns:i18n="http://xml.zope.org/namespaces/i18n"
    metal:use-macro="context/main_template/macros/master"
    i18n:domain="gwopa">
<body>

<metal:content-core fill-slot="main">

  <metal:block define-macro="content-core"
      tal:define="partners context/partners;
                  project_manager context/project_manager;
                  budget context/budget;
                  contribution context/contribution;
                  wop_program context/wop_program;
                  google_maps_link view/google_maps_link;
                  getImprovementAreas view/getImprovementAreas">

    <h1 class="documentFirstHeading" tal:content="context/title"> Project Title </h1>

    <div class="row">
      <tal:block tal:condition="context/image">
        <div class="col-md-3">
            <img class="fullwidth" tal:attributes="src string:${context/absolute_url}/@@images/image" />
        </div>
        <div class="col-md-9">
          <div class="documentDescription description" i18n:translate="" tal:content="context/description"> Project description </div>
          <div tal:condition="partners">
            <h3 i18n:translate="">Partners</h3>
            <ul tal:repeat="partner partners">
              <li tal:content="partner"></li>
            </ul>
          </div>

          <div tal:condition="project_manager">
            <h3 i18n:translate="">Project Manager</h3>
            <span tal:content="project_manager" />
          </div>

          <div tal:condition="budget">
            <h3 i18n:translate=""> Total budget</h3>
            <span tal:content="budget" /> <span tal:content="view/get_currency" />
          </div>

          <div tal:condition="contribution">
            <h3 i18n:translate="">Contribution by partners and donors</h3>
            <span tal:replace="structure contribution/output" />
          </div>

          <div tal:condition="wop_program">
            <h3 i18n:translate="">WOP Program</h3>
            <ul tal:repeat="wop wop_program">
              <li tal:content="wop"></li>
            </ul>
          </div>
        </div>
        <div class="documentDescription"></div>
      </tal:block>
      <tal:block tal:condition="not:context/image">
        <div class="col-md-12">
          <div class="documentDescription description" i18n:translate="" tal:content="context/description"> Project description </div>
          <div tal:condition="partners">
            <h3 i18n:translate="">Partners</h3>
            <ul tal:repeat="partner partners">
              <li tal:content="partner"></li>
            </ul>
          </div>

          <div tal:condition="project_manager">
            <h3 i18n:translate="">Project Manager</h3>
            <span tal:content="project_manager" />
          </div>

          <div tal:condition="budget">
            <h3 i18n:translate=""> Total budget</h3>
            <span tal:content="budget" /> <span tal:content="view/get_currency" />
          </div>

          <div tal:condition="contribution">
            <h3 i18n:translate="">Contribution by partners and donors</h3>
            <span tal:replace="structure contribution/output" />
          </div>

          <div tal:condition="wop_program">
            <h3 i18n:translate="">WOP Program</h3>
            <ul tal:repeat="wop wop_program">
              <li tal:content="wop"></li>
            </ul>
          </div>
        </div>
        <div class="documentDescription"></div>
      </tal:block>
    </div>

      <tal:map tal:condition="google_maps_link">
        <div tal:define="latitude context/geolocation/latitude;
                     longitude context/geolocation/longitude;"
              class="pat-leaflet map"
         data-geojson='{
          "type": "FeatureCollection",
          "features": [
            {
              "type": "Feature",
              "id": 1,
              "properties":
              {
                "popup": "<h4><a href=>${context/Title}</a></h4><p>Start: ${context/start}</p><p>End: ${context/end}</p>"
              },
              "geometry":
              {
                "type": "Point",
                "coordinates": [ ${longitude}, ${latitude} ]
              }
            }
          ]}' data-pat-leaflet='{
           "fullscreencontrol": true,
           "locatecontrol": false,
           "zoomcontrol": true,
           "minimap": false,
           "addmarker": false,
           "zoom": 17,
           "map_layers": [
            {"title": "Map", "id": "OpenStreetMap.BlackAndWhite"}
           ]
          }'>
        </div>
        <i class="fas fa-external-link-square-alt"></i>
        <a tal:attributes="href google_maps_link" i18n:translate="label_google_maps_link" target="_blank">Show in Google Maps</a>
      </tal:map>

    <h2><tal:omit-tag i18n:translate="">Improvement Areas</tal:omit-tag>
    <a class="pat-plone-modal right" id="add-new-improvementarea" data-pat-plone-modal="{&quot;actionOptions&quot;: {&quot;displayInModal&quot;: false}}" tal:attributes="href string:${context/absolute_url}/++add++ImprovementArea">
        <button id="add-new-improvementarea" class="context focus" i18n:translate=""> + New Improvemnet Area</button>
    </a></h2>


    <h3 tal:condition="not:getImprovementAreas" i18n:translate="">
      No Improvement Areas found
    </h3>

<div class="row-fluid">
    <tal:block tal:condition="getImprovementAreas">
      <tal:areas repeat="item getImprovementAreas">
        <div class="col-lg-3 col-md-6">
          <a tal:attributes="href item/url;
                             title item/title;
                             alt item/title">
            <div class="box">
              <img class="box-img" style="width:100%"
                   tal:attributes="src string:${item/image};"/>
              <div class="card-body">
                <h4 class="card-title">
                  <a tal:attributes="href item/url" tal:content="item/title">Event Title</a>
                </h4>
              </div>
            </div>
          </a>
        </div>
      </tal:areas>
    </tal:block>
</div>
</metal:block>

</metal:content-core>

</body>
</html>
